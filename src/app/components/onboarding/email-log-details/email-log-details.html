

<div class="container-fluid py-4">

  <div class="alert alert-info mb-3" *ngIf="loading || error">
    <strong>Debug Info:</strong> 
    <span *ngIf="logId">Current Log ID: {{logId}}</span>
    <span *ngIf="!logId">No valid Log ID found</span>
    <button class="btn btn-sm btn-outline-info ms-2" (click)="debugDataStructure()" *ngIf="logDetails">
      Debug Data
    </button>
  </div>


  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border" style="color: #009B8C" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2" style="color: #009B8C">Loading email log details for ID: {{logId}}...</p>
    <p class="text-muted">API: {{environment?.apiBaseUrl}}/onboarding/email-logs/{{logId}}</p>
  </div>


  <div *ngIf="error && !loading" class="alert alert-danger">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ error }}
    <div class="mt-3">
      <button class="btn btn-sm btn-outline-secondary me-2" (click)="goBack()">
        <i class="bi bi-arrow-left me-1"></i> Back to Logs
      </button>
      <button class="btn btn-sm btn-outline-primary" (click)="loadEmailLogDetails(logId!)" *ngIf="logId">
        <i class="bi bi-arrow-clockwise me-1"></i> Retry
      </button>
    </div>
  </div>

 
  <div *ngIf="logDetails && !loading && !error">
   
    <!-- Header with Transparent Teal Background -->
    <div class="p-4 rounded-3 mb-4" style="background: linear-gradient(135deg, rgba(0, 155, 140, 0.1) 0%, rgba(0, 155, 140, 0.05) 100%); border: 1px solid rgba(0, 155, 140, 0.2);">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <button class="btn btn-light btn-sm me-3" (click)="goBack()">
            <i class="bi bi-arrow-left"></i>
          </button>
          <div>
            <h1 class="h3 mb-1" style="color: #009B8C">
              <i class="bi bi-envelope-check me-2"></i>Email Log Details
            </h1>
            <p class="text-muted mb-0">Log ID: {{logId}} â€¢ Monitor email delivery status and performance</p>
          </div>
        </div>
        <button *ngIf="logDetails.emailsFailed > 0" 
                class="btn text-white btn-sm" 
                (click)="resendFailedEmails()"
                style="background-color: #009B8C; border-color: #009B8C">
          <i class="bi bi-send me-1"></i> Resend Failed
        </button>
      </div>
    </div>

    
    <div class="row mb-4">
      <div class="col-xl-3 col-md-6 mb-3">
        <div class="card border-0 h-100" style="background-color: rgba(0, 155, 140, 0.05); border-left: 4px solid #009B8C">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h2 class="mb-0" style="color: #009B8C">{{logDetails.totalEmployees || 0}}</h2>
                <p class="text-muted mb-0">Total Employees</p>
              </div>
              <i class="bi bi-people fs-1" style="color: #009B8C; opacity: 0.5"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6 mb-3">
        <div class="card border-0 h-100" style="background-color: rgba(25, 135, 84, 0.05); border-left: 4px solid #198754">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h2 class="mb-0 text-success">{{logDetails.emailsSent || 0}}</h2>
                <p class="text-muted mb-0">Sent Successfully</p>
              </div>
              <i class="bi bi-check-circle fs-1 text-success" style="opacity: 0.5"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6 mb-3">
        <div class="card border-0 h-100" style="background-color: rgba(220, 53, 69, 0.05); border-left: 4px solid #dc3545">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h2 class="mb-0 text-danger">{{logDetails.emailsFailed || 0}}</h2>
                <p class="text-muted mb-0">Failed</p>
              </div>
              <i class="bi bi-x-circle fs-1 text-danger" style="opacity: 0.5"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6 mb-3">
        <div class="card border-0 h-100" style="background-color: rgba(255, 193, 7, 0.05); border-left: 4px solid #ffc107">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h2 class="mb-0 text-warning">{{logDetails.ineligibleDueToDate || 0}}</h2>
                <p class="text-muted mb-0">Ineligible</p>
              </div>
              <i class="bi bi-calendar-x fs-1 text-warning" style="opacity: 0.5"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

  
    <div class="row">
      
      <div class="col-lg-4 mb-4">
        <div class="card border h-100">
          <div class="card-header text-white" style="background-color: #009B8C">
            <h5 class="card-title mb-0">
              <i class="bi bi-info-circle me-2"></i>Log Information
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <strong style="color: #009B8C">Status:</strong>
              <span [class]="'badge bg-' + getStatusColor(logDetails.status) + ' ms-2'">
                {{logDetails.status || 'UNKNOWN'}}
              </span>
            </div>
            <div class="mb-3">
              <strong style="color: #009B8C">Started At:</strong><br>
              {{logDetails.startedAt | date:'medium'}}
            </div>
            <div class="mb-3" *ngIf="logDetails.completedAt">
              <strong style="color: #009B8C">Completed At:</strong><br>
              {{logDetails.completedAt | date:'medium'}}
            </div>
            <div class="mb-3">
              <strong style="color: #009B8C">Date Format Errors:</strong><br>
              {{logDetails.dateFormatErrors || 0}}
            </div>
          </div>
        </div>
      </div>

     
      <div class="col-lg-8">
        <div class="card border h-100">
          <div class="card-header text-white" style="background-color: #009B8C">
            <h5 class="card-title mb-0">
              <i class="bi bi-list-ul me-2"></i>Email Lists
            </h5>
          </div>
          <div class="card-body">
          
            <ul class="nav nav-tabs mb-3">
              <li class="nav-item">
                <a class="nav-link" 
                   [class.active]="activeTab === 'sent'" 
                   [style]="activeTab === 'sent' ? 'color: #009B8C; border-bottom: 2px solid #009B8C; font-weight: 500' : 'color: #6c757d'"
                   (click)="setActiveTab('sent')">
                  <i class="bi bi-check-circle me-1"></i>
                  Sent ({{getSentEmails().length}})
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" 
                   [class.active]="activeTab === 'failed'" 
                   [style]="activeTab === 'failed' ? 'color: #009B8C; border-bottom: 2px solid #009B8C; font-weight: 500' : 'color: #6c757d'"
                   (click)="setActiveTab('failed')">
                  <i class="bi bi-x-circle me-1"></i>
                  Failed ({{getFailedEmails().length}})
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" 
                   [class.active]="activeTab === 'ineligible'" 
                   [style]="activeTab === 'ineligible' ? 'color: #009B8C; border-bottom: 2px solid #009B8C; font-weight: 500' : 'color: #6c757d'"
                   (click)="setActiveTab('ineligible')">
                  <i class="bi bi-calendar-x me-1"></i>
                  Ineligible ({{getIneligibleEmails().length}})
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" 
                   [class.active]="activeTab === 'dateErrors'" 
                   [style]="activeTab === 'dateErrors' ? 'color: #009B8C; border-bottom: 2px solid #009B8C; font-weight: 500' : 'color: #6c757d'"
                   (click)="setActiveTab('dateErrors')">
                  <i class="bi bi-exclamation-triangle me-1"></i>
                  Date Errors ({{getDateErrorEmails().length}})
                </a>
              </li>
            </ul>

            <div class="tab-content">
            
              <div *ngIf="activeTab === 'sent'" class="tab-pane fade show active">
                <div *ngIf="getSentEmails().length > 0" class="border rounded mb-3" style="max-height: 300px; overflow-y: auto">
                  <div *ngFor="let email of getCurrentPageEmails('sent'); let i = index" 
                       class="d-flex align-items-center p-2 border-bottom">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <span class="text-success">{{email}}</span>
                  </div>
                </div>
                
                <!-- Pagination for Sent Emails -->
                <div *ngIf="getSentEmails().length > pageSize" class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    Showing {{getStartIndex() + 1}}-{{getEndIndex('sent')}} of {{getSentEmails().length}} emails
                  </small>
                  <nav>
                    <ul class="pagination pagination-sm mb-0">
                      <li class="page-item" [class.disabled]="currentPage === 1">
                        <a class="page-link" (click)="previousPage()">Previous</a>
                      </li>
                      <li class="page-item" [class.active]="currentPage === page" *ngFor="let page of getPages('sent')">
                        <a class="page-link" (click)="goToPage(page)">{{page}}</a>
                      </li>
                      <li class="page-item" [class.disabled]="currentPage === getTotalPages('sent')">
                        <a class="page-link" (click)="nextPage('sent')">Next</a>
                      </li>
                    </ul>
                  </nav>
                </div>

                <div *ngIf="getSentEmails().length === 0" class="text-center text-muted py-3">
                  <i class="bi bi-inbox fs-1"></i>
                  <p class="mt-2">No sent emails found</p>
                </div>
              </div>

             
              <div *ngIf="activeTab === 'failed'" class="tab-pane fade show active">
                <div *ngIf="getFailedEmails().length > 0" class="border rounded mb-3" style="max-height: 300px; overflow-y: auto">
                  <div *ngFor="let email of getCurrentPageEmails('failed'); let i = index" 
                       class="d-flex align-items-center p-2 border-bottom">
                    <i class="bi bi-x-circle text-danger me-2"></i>
                    <span class="text-danger">{{email}}</span>
                  </div>
                </div>
                
                <!-- Pagination for Failed Emails -->
                <div *ngIf="getFailedEmails().length > pageSize" class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    Showing {{getStartIndex() + 1}}-{{getEndIndex('failed')}} of {{getFailedEmails().length}} emails
                  </small>
                  <nav>
                    <ul class="pagination pagination-sm mb-0">
                      <li class="page-item" [class.disabled]="currentPage === 1">
                        <a class="page-link" (click)="previousPage()">Previous</a>
                      </li>
                      <li class="page-item" [class.active]="currentPage === page" *ngFor="let page of getPages('failed')">
                        <a class="page-link" (click)="goToPage(page)">{{page}}</a>
                      </li>
                      <li class="page-item" [class.disabled]="currentPage === getTotalPages('failed')">
                        <a class="page-link" (click)="nextPage('failed')">Next</a>
                      </li>
                    </ul>
                  </nav>
                </div>

                <div *ngIf="getFailedEmails().length === 0" class="text-center text-muted py-3">
                  <i class="bi bi-inbox fs-1"></i>
                  <p class="mt-2">No failed emails found</p>
                </div>
              </div>

             
              <div *ngIf="activeTab === 'ineligible'" class="tab-pane fade show active">
                <div *ngIf="getIneligibleEmails().length > 0" class="border rounded mb-3" style="max-height: 300px; overflow-y: auto">
                  <div *ngFor="let email of getCurrentPageEmails('ineligible'); let i = index" 
                       class="d-flex align-items-center p-2 border-bottom">
                    <i class="bi bi-calendar-x text-warning me-2"></i>
                    <span class="text-warning">{{email}}</span>
                  </div>
                </div>
                
                <!-- Pagination for Ineligible Emails -->
                <div *ngIf="getIneligibleEmails().length > pageSize" class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    Showing {{getStartIndex() + 1}}-{{getEndIndex('ineligible')}} of {{getIneligibleEmails().length}} emails
                  </small>
                  <nav>
                    <ul class="pagination pagination-sm mb-0">
                      <li class="page-item" [class.disabled]="currentPage === 1">
                        <a class="page-link" (click)="previousPage()">Previous</a>
                      </li>
                      <li class="page-item" [class.active]="currentPage === page" *ngFor="let page of getPages('ineligible')">
                        <a class="page-link" (click)="goToPage(page)">{{page}}</a>
                      </li>
                      <li class="page-item" [class.disabled]="currentPage === getTotalPages('ineligible')">
                        <a class="page-link" (click)="nextPage('ineligible')">Next</a>
                      </li>
                    </ul>
                  </nav>
                </div>

                <div *ngIf="getIneligibleEmails().length === 0" class="text-center text-muted py-3">
                  <i class="bi bi-inbox fs-1"></i>
                  <p class="mt-2">No ineligible emails found</p>
                </div>
              </div>

             
              <div *ngIf="activeTab === 'dateErrors'" class="tab-pane fade show active">
                <div *ngIf="getDateErrorEmails().length > 0" class="border rounded mb-3" style="max-height: 300px; overflow-y: auto">
                  <div *ngFor="let email of getCurrentPageEmails('dateErrors'); let i = index" 
                       class="d-flex align-items-center p-2 border-bottom">
                    <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                    <span class="text-warning">{{email}}</span>
                  </div>
                </div>
                
                <!-- Pagination for Date Error Emails -->
                <div *ngIf="getDateErrorEmails().length > pageSize" class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    Showing {{getStartIndex() + 1}}-{{getEndIndex('dateErrors')}} of {{getDateErrorEmails().length}} emails
                  </small>
                  <nav>
                    <ul class="pagination pagination-sm mb-0">
                      <li class="page-item" [class.disabled]="currentPage === 1">
                        <a class="page-link" (click)="previousPage()">Previous</a>
                      </li>
                      <li class="page-item" [class.active]="currentPage === page" *ngFor="let page of getPages('dateErrors')">
                        <a class="page-link" (click)="goToPage(page)">{{page}}</a>
                      </li>
                      <li class="page-item" [class.disabled]="currentPage === getTotalPages('dateErrors')">
                        <a class="page-link" (click)="nextPage('dateErrors')">Next</a>
                      </li>
                    </ul>
                  </nav>
                </div>

                <div *ngIf="getDateErrorEmails().length === 0" class="text-center text-muted py-3">
                  <i class="bi bi-inbox fs-1"></i>
                  <p class="mt-2">No date format errors found</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>