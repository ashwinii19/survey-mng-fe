<div id="response-summary-root" class="response-summary-root">
 
  <!-- loader modal -->
  <div class="export-loader" *ngIf="isExporting">
    <div class="loader-box">
      <div class="spinner"></div>
      <p>{{ exportMessage }}</p>
    </div>
  </div>
 
  <!-- hidden logo top-left (visible only during export via root class) -->
  <img id="summary-export-logo" src="assets/images/aurionpro-logo.jpg" alt="logo" class="export-logo" />
 
  <!-- header -->
  <div class="header-row">
    <div>
      <h1 class="page-title">{{ summary?.surveyTitle || ('Survey ' + surveyId) }}</h1>
      <p class="subtle">Response Summary</p>
    </div>
 
    <div class="export-controls">
      <button class="btn export-btn" (click)="exportExcel()" [disabled]="isExporting">Export Excel</button>
      <button class="btn export-btn" (click)="exportPDF()" [disabled]="isExporting">Export PDF</button>
      <button class="btn export-btn" (click)="exportPPT()" [disabled]="isExporting">Export PPT</button>
    </div>
  </div>
 
  <div *ngIf="summary" class="summary-wrapper">
 
    <div class="stats-row">
      <div class="stat-box"><h3>Total Employees</h3><p>{{ summary.totalEmployees }}</p></div>
      <div class="stat-box"><h3>Submitted</h3><p>{{ summary.submittedCount }}</p></div>
      <div class="stat-box"><h3>Pending</h3><p>{{ summary.pendingCount }}</p></div>
      <div class="stat-box"><h3>Submission %</h3>
        <p>{{ summary.totalEmployees ? ((summary.submittedCount / summary.totalEmployees) * 100 | number:'1.0-1') : '0.0' }}%</p>
      </div>
    </div>
 
    <hr />
 
    <div *ngFor="let q of questionStats; let i = index" class="question-card">
      <h3 class="q-head">Q{{ i + 1 }}. {{ q.questionText }}</h3>
      <p class="type">Type: {{ q.questionType }}</p>
      <p class="small">Total Responses: {{ q.totalResponses }}</p>
 
      <!-- Option questions: show charts + option table + employee table -->
      <div *ngIf="hasOptions(q)">
        <div class="chart-row">
          <div class="chart-box">
            <div class="chart-canvas-wrapper">
              <!-- canvas id used by TS to grab base64 -->
              <canvas id="pie-{{ q.questionId }}" baseChart [data]="buildPieData(q)"
                      [type]="'pie'" [options]="pieOptions">
              </canvas>
            </div>
          </div>
 
          <div class="chart-box">
            <div class="chart-canvas-wrapper">
              <canvas id="bar-{{ q.questionId }}" baseChart [data]="buildBarData(q)"
                      [type]="'bar'" [options]="barOptions">
              </canvas>
            </div>
          </div>
        </div>
 
        <table class="option-table">
          <thead><tr><th>Option</th><th>Count</th><th>Percentage</th></tr></thead>
          <tbody>
            <tr *ngFor="let opt of (q.optionCounts | keyvalue)">
              <td class="opt-key">{{ opt.key }}</td>
              <td>{{ opt.value }}</td>
              <td>{{ calculatePercentage(opt.value, q.totalResponses) | number:'1.0-1' }}%</td>
            </tr>
          </tbody>
        </table>
 
        <!-- Employee list for option answers -->
        <div *ngIf="q.responses?.length" class="employee-table-wrapper">
          <!-- <h4 class="emp-head">Employee | ID | Answer</h4> -->
          <table class="option-table">
            <thead><tr><th>Employee</th><th>ID</th><th>Answer</th></tr></thead>
            <tbody>
              <tr *ngFor="let r of q.responses">
                <td>{{ r.employeeName }}</td>
                <td>{{ r.employeeId }}</td>
                <td>{{ r.answerText }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
 
      <!-- TEXT questions: employee table only -->
      <div *ngIf="!hasOptions(q)">
        <!-- <h4 class="emp-head">Employee | ID | Answer</h4> -->
        <table class="option-table">
          <thead><tr><th>Employee</th><th>ID</th><th>Answer</th></tr></thead>
          <tbody>
            <tr *ngFor="let r of (q.responses || [])">
              <td>{{ r.employeeName }}</td>
              <td>{{ r.employeeId }}</td>
              <td>{{ r.answerText }}</td>
            </tr>
          </tbody>
        </table>
      </div>
 
    </div>
  </div>
</div>