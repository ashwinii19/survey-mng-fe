<div class="recent-wrapper">

  <div class="recent-container">

    <h2>Recent Surveys</h2>

    <div *ngIf="surveys.length === 0" class="empty">
      No surveys created yet.
    </div>

    <div class="table-responsive" *ngIf="surveys.length > 0">

      <table class="survey-table">
        <thead>
          <tr>
            <th>Sr No.</th>
            <th>Survey Title</th>
            <th>Department(s)</th>
            <th>Position</th>
            <th>Questions</th>
            <th>Created Date</th>
            <th>Status</th>
            <th style="width: 360px;">Action</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let s of pagedSurveys; let i = index">

            <td>{{ i + 1 }}</td>
            <td>{{ s.title }}</td>

            <td>
              {{ s.targetDepartments?.includes('ALL')
              ? 'ALL'
              : s.targetDepartments?.join(', ') }}
            </td>

            <td>{{ s.targetPosition || 'â€”' }}</td>

            <td>{{ s.questions?.length }}</td>
            <td>{{ s.createdAt | date:'dd MMM yyyy, hh:mm a' }}</td>

            <td>
              <span class="status-badge" [ngClass]="
                s.published
                  ? 'published'
                  : (s.editable ? 'draft' : 'created')
              ">
                {{ s.published ? 'Published' : (s.editable ? 'Draft' : 'Created') }}
              </span>
            </td>

            <td class="action-col">

              <button *ngIf="s.editable && !s.published"
                      class="btn edit-btn"
                      (click)="editSurvey(s.id)">
                Edit
              </button>

              <ng-container *ngIf="!s.editable && !s.published">
                <button class="btn publish-btn" (click)="publishSurvey(s.id)">
                  Publish
                </button>

                <a class="btn view-btn" [href]="openForm(s.formLink)" target="_blank">
                  View
                </a>
              </ng-container>

              <ng-container *ngIf="s.published">
                <button class="btn response-btn" (click)="viewResponses(s.id)">
                  View Responses
                </button>

                <a class="btn view-btn" [href]="openForm(s.formLink)" target="_blank">
                  View Form
                </a>
              </ng-container>

              <button class="btn delete-btn" (click)="deleteSurvey(s.id)">
                Delete
              </button>

            </td>

          </tr>

        </tbody>
      </table>

    </div>

    <div class="pagination-controls" *ngIf="totalPages > 1">

      <button (click)="prevPage()" [disabled]="currentPage === 1" class="btn">
        Previous
      </button>

      <button
        *ngFor="let page of pages"
        (click)="goToPage(page)"
        [class.active]="page === currentPage"
        class="btn page-btn">
        {{ page }}
      </button>

      <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="btn">
        Next
      </button>

    </div>

  </div>

</div>


<!-- POPUP LOADER -->
<div class="popup-overlay" *ngIf="loading">
  <div class="popup-loader-box">
    <div class="popup-spinner"></div>
    <p>{{ loadingMessage }}</p>
  </div>
</div>
