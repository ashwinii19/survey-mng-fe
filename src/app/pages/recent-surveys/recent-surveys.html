<div class="recent-wrapper">

  <h2>Recent Surveys</h2>

  <!-- Empty State -->
  <div *ngIf="surveys.length === 0" class="empty">
    No surveys created yet.
  </div>

  <!-- Surveys Table -->
  <table class="survey-table" *ngIf="surveys.length > 0">
    <thead>
      <tr>
        <th>Sr No.</th>
        <th>Survey Title</th>
        <th>Department</th>
        <th>Questions</th>
        <th>Created Date</th>
        <th>Status</th>
        <th style="width: 260px;">Action</th>
      </tr>
    </thead>

    <tbody>

      <tr *ngFor="let s of pagedSurveys; let i = index">

        <!-- New SR NO Column -->
        <td>{{ i + 1 }}</td>

        <td>{{ s.title }}</td>

        <td>{{ s.targetDepartment?.name || '-' }}</td>

        <td>{{ s.questions?.length }}</td>

        <td>{{ s.createdAt | date:'dd MMM yyyy, hh:mm a' }}</td>

        <td>
          <span class="status-badge"
            [ngClass]="
                s.published
                  ? 'published'
                  : (s.editable ? 'draft' : 'created')
            ">

            {{ s.published ? 'Published' : (s.editable ? 'Draft' : 'Created') }}

          </span>
        </td>

        <!-- ACTION BUTTONS -->
        <td class="action-col">

          <!-- EDIT (Only When editable AND not published) -->
          <button *ngIf="s.editable && !s.published"
                  class="btn edit-btn"
                  (click)="editSurvey(s.id)">
            Edit
          </button>

          <!-- PUBLISH + VIEW (editable false & not published) -->
          <ng-container *ngIf="!s.editable && !s.published">
            <button class="btn publish-btn" (click)="publishSurvey(s.id)">
              Publish
            </button>

            <a class="btn view-btn"
               [href]="openForm(s.formLink)"
               target="_blank">
              View
            </a>
          </ng-container>

          <!-- VIEW (if published) -->
          <ng-container *ngIf="s.published">
            <a class="btn view-btn"
               [href]="openForm(s.formLink)"
               target="_blank">
              View
            </a>
          </ng-container>

          <!-- DELETE -->
          <button class="btn delete-btn"
                  (click)="deleteSurvey(s.id)">
            Delete
          </button>

        </td>
      </tr>

    </tbody>
  </table>

  <!-- Pagination Controls -->
  <div class="pagination-controls" *ngIf="totalPages > 1">
    
    <button (click)="prevPage()"
            [disabled]="currentPage === 1"
            class="btn">
      Previous
    </button>

    <button *ngFor="let page of pages"
            (click)="goToPage(page)"
            [class.active]="page === currentPage"
            class="btn page-btn">
      {{ page }}
    </button>

    <button (click)="nextPage()"
            [disabled]="currentPage === totalPages"
            class="btn">
      Next
    </button>

  </div>

</div>

<!-- FULL SCREEN LOADER -->
<div class="loader-overlay" *ngIf="loading">
  <div class="loader-box">
    <div class="spinner"></div>
    <p>Publishing the surveyâ€¦</p>
  </div>
</div>
