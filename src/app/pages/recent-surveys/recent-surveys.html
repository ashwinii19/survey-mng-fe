<div class="recent-wrapper">

  <h2>Recent Surveys</h2>

  <div *ngIf="surveys.length === 0" class="empty">No surveys created yet.</div>

  <table class="survey-table" *ngIf="surveys.length > 0">
    <thead>
      <tr>
        <th>Survey Title</th>
        <th>Department</th>
        <th>Questions</th>
        <th>Created Date</th>
        <th>Status</th>
        <th style="width: 260px;">Action</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let s of pagedSurveys">

        <td>{{ s.title }}</td>
        <td>{{ s.targetDepartment?.name || '-' }}</td>
        <td>{{ s.questions?.length }}</td>
        <td>{{ s.createdAt | date:'dd MMM yyyy, hh:mm a' }}</td>

        <td>
          <span class="status-badge"
            [ngClass]="s.published ? 'published' : (s.editable ? 'draft' : 'created')">
            {{ s.published ? 'Published' : (s.editable ? 'Draft' : 'Created') }}
          </span>
        </td>

        <td class="action-col">

          <button *ngIf="s.editable === true && s.published === false"
            class="btn edit-btn"
            (click)="editSurvey(s.id)">
            Edit
          </button>

          <ng-container *ngIf="s.editable === false && s.published === false">
            <button class="btn publish-btn" (click)="publishSurvey(s.id)">
              Publish
            </button>

            <a class="btn view-btn" [href]="openForm(s.formLink)" target="_blank">
              View
            </a>
          </ng-container>

          <ng-container *ngIf="s.published === true">
            <a class="btn view-btn" [href]="openForm(s.formLink)" target="_blank">
              View
            </a>
          </ng-container>

          <button class="btn delete-btn" (click)="deleteSurvey(s.id)">
            Delete
          </button>

        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination Controls -->
  <div class="pagination-controls" *ngIf="totalPages > 1">
    <button (click)="prevPage()" [disabled]="currentPage === 1" class="btn">Previous</button>

    <button
      *ngFor="let page of pages"
      (click)="goToPage(page)"
      [class.active]="page === currentPage"
      class="btn page-btn">
      {{ page }}
    </button>

    <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="btn">Next</button>
  </div>

</div>


<!-- ðŸ”µ FULL SCREEN LOADER ADDED BELOW -->
<div class="loader-overlay" *ngIf="loading">
  <div class="loader-box">
    <div class="spinner"></div>
    <p>Publishing the surveyâ€¦</p>
  </div>
</div>
